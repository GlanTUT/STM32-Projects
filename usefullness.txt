On moving average, not sure if you read from fifo or not but a simple way to perform a moving average is this:

Code: [Select]
  avg += (new_data - avg) >> n;

it is essentially the binary implementation of this:

Code: [Select]
  avg = avg * (1-weight) + new_data * weight;

where "weight" is 1/2^n.

It requires little data and can be done quickly, even on lowly 8-bitters.

n effectively controls the memory of the filter: the higher the n, the longer it remembers the past and the slower its output changes with new data.

Hope it helps.
